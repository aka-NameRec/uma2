# –î–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º ConPort –∏ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π
_Exported on 03.01.2026 at 13:03:53 GMT+3 from Cursor (2.2.43)_

---

**User**

(20251222-142159) (20251222-145544)

(1) –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏–∑—É—á–∏ –¥–æ–∫—É–º–µ–Ω—Ç `docs/20251201-010207-intro.md` ‚Äì —ç—Ç–æ –Ω–∞—à –∫–æ–Ω—Ç–µ–∫—Å—Ç, –∏ –æ–±–Ω–æ–≤–∏ ConPort –∑–Ω–∞–Ω–∏—è–º–∏ –∏–∑ —ç—Ç–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞.

(2) –í –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫ –æ–±—Å—É–∂–¥–∞–≤—à–µ–º—É—Å—è, –Ω–∞–º –Ω—É–∂–Ω–æ:
1) –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ `select`.
2) –û–±–µ—Å–ø–µ—á–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ CRUD-–æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞–¥ –æ–±—ä–µ–∫—Ç–∞–º–∏ –ë–î.

(3) –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ `select`, –¥—É–º–∞—é, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `params` –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é, –≤—ã–ø–æ–ª–Ω—è—é—â—É—é JSQL.
–ü–∞—Ä–∞–º–µ—Ç—Ä –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Ç–∏–ø–∞ `dict[str, Any]`, —á—Ç–æ–±—ã –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –∑–∞–ø—Ä–æ—Å–∞ –±—ã–ª–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–∫–∞–∑–∞—Ç—å —É–∫–∞–∑–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ª—é–±–æ–≥–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ–≥–æ –°–£–ë–î —Ç–∏–ø–∞.

(4) –î–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ CRUD –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:
* `read` –≤—ã–ø–æ–ª–Ω—è–µ—Ç —á—Ç–µ–Ω–∏–µ –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏ –ø–æ `id` (–ø–∞—Ä–∞–º–µ—Ç—Ä –æ–ø–µ—Ä–∞—Ü–∏–∏), –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∫–æ—Ç–æ—Ä–æ–≥–æ —á–∞—â–µ –≤—Å–µ–≥–æ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è PK —Ç–∞–±–ª–∏—Ü—ã.
* `save` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∑–∞–ø–∏—Å—å –≤ –ë–î (–∑–∞–ø–∏—Å—å –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º, —Å–∫–∞–∂–µ–º `OrderedDict`, –≤ –∫–æ—Ç–æ—Ä–æ–º key –ø–æ–Ω–∏–º–∞–µ—Ç—Å—è –∫–∞–∫ –∏–º—è –ø–æ–ª—è, –∞ value ‚Äì –µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏–µ), –ø—Ä–∏—á—ë–º –≤ —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ `id` (PK) —ç—Ç–æ–π –∑–∞–ø–∏—Å–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–Ω–∞—á–µ–Ω–∏–µ `NULL` (`None`) –¥–æ–ª–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏ *—Å—É—â–Ω–æ—Å—Ç–∏* (—Å–º. –¥–∞–ª–µ–µ), –µ—Å–ª–∏ –∂–µ —Ç–∞–º —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –æ—Ç–ª–∏—á–Ω–æ–µ –æ—Ç `NULL` –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äì –¥–æ–ª–∂–Ω–∞ –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –∑–∞–ø–∏—Å–∏ —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º `id`.
* `delete` –≤—ã–ø–æ–ª–Ω—è–µ—Ç —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏, `id` –∫–æ—Ç–æ—Ä–æ–π –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ —Ñ—É–Ω–∫—Ü–∏—é –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞.

(5) –†–∞–Ω–µ–µ –≥–æ–≤–æ—Ä–∏–ª–æ—Å—å –æ –ø–æ–¥–¥–µ—Ä–∂–∫–µ UMA-–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π (`views`), –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –≤ JSQL-–∑–∞–ø—Ä–æ—Å–∞—Ö –∫–∞–∫ –æ–±—ã—á–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã.
–ó–∞–ø—Ä–æ—Å—ã –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π –º–æ–≥—É—Ç –±—ã—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞, –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ–º—ã–º–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏ –æ—Ç–±–æ—Ä–∞ –∑–∞–ø–∏—Å–µ–π –≤ –æ–ø–µ—Ä–∞—Ü–∏–∏ `select` –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è.

‚ùï–ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—ã–º –æ–±–æ–±—â–∏—Ç—å –ø–æ–Ω—è—Ç–∏–µ *—Å—É—â–Ω–æ—Å—Ç–∏* ((`entity`) ‚Äì –ø—Ä–æ—Å—Ç–∞—è —Ç–∞–±–ª–∏—Ü–∞, –∏–ª–∏ –∫–æ–º–ø–æ–∑–∏—Ç–Ω—ã–π –æ–±—ä–µ–∫—Ç –∏–ª–∏ –≤—ã–±–æ—Ä–∫–∞ –∑–∞–ø–∏—Å–µ–π —Å –º–Ω–æ–≥–∏–º–∏ JOIN –∏, –≤–æ–∑–º–æ–∂–Ω–æ, UNION) –∫–∞–∫ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ, –æ–ø—Ä–µ–¥–µ–ª–∏–≤ —Å—É—â–Ω–æ—Å—Ç—å –∫–∞–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º—ã–π –∫–ª–∞—Å—Å (—Ä–∞–Ω–µ–µ –≥–æ–≤–æ—Ä–∏–ª–∏ –æ–± —ç—Ç–æ–º –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π), —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –æ–ø–µ—Ä–∞—Ü–∏–∏ `select`, `read`, `save` –∏ `delete`.

(6) –í —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ —Å—É—â–Ω–æ—Å—Ç—å-–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–∏—Ç–∏–∫—É –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –æ—Ç–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö, —ç—Ç–∞ –ø–æ–ª–∏—Ç–∏–∫–∞ –±—É–¥–µ—Ç –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä–æ–≤–∞–Ω–∞ –≤ `select` (–∑–∞–ø–∏—Å–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–µ—Ç—å –Ω–µ –¥–æ–ª–∂–µ–Ω, –∏—Å–∫–ª—é—á–∞—é—Ç—Å—è –∏–∑ –≤—ã–±–æ—Ä–∫–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏ –æ—Ç–±–æ—Ä–∞), –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –≤ `read` ‚Äì –∑–∞–ø–∏—Å—å –∏—Å–∫–ª—é—á–∞–µ—Ç—Å—è –∏–∑ –≤—ã–±–æ—Ä–∫–∏ –µ—Å–ª–∏ –µ—ë –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `select` –¥–∞–∂–µ –µ—Å–ª–∏ –∑–∞–ø–∏—Å—å —Å —Ç–∞–∫–∏–º `id` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ, –Ω–∞ –±–∞–∑–µ –∫–æ—Ç–æ—Ä–æ–π —Å–æ–∑–¥–∞–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ. 

(7) –°—É—â–Ω–æ—Å—Ç—å `entity`, —è–≤–ª—è—è—Å—å –≤ –æ–±—â–µ–º —Å–ª—É—á–∞–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ–º, –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ JSQL-–∑–∞–ø—Ä–æ—Å–∞—Ö, –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å, –Ω–æ –º–æ–∂–µ—Ç –∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é CRUD-–æ–ø–µ—Ä–∞—Ü–∏–π (–≤–∫–ª—é—á–∞—è `read`, –ø–æ—Å–∫–æ–ª—å–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º `select` –º–æ–∂–µ—Ç –±—ã—Ç—å –∫–∞–∫–æ–π-–Ω–∏–±—É–¥—å UNION –∏–ª–∏ –¥–∞–∂–µ cross-join).
–í –ø–æ—Å–ª–µ–¥–Ω–µ–º —Å–ª—É—á–∞–µ –º—ã –±—É–¥–µ–º –≥–æ–≤–æ—Ä–∏—Ç—å –æ readonly-—Å—É—â–Ω–æ—Å—Ç–∏.

(8) –ü—Ä–æ—Ç–æ–∫–æ–ª –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è JSQL –¥–æ–ª–∂–µ–Ω –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –ø—Ä–∏—Ä–æ–¥—É —Å—É—â–Ω–æ—Å—Ç–∏, —É–ø–æ–º–∏–Ω–∞–µ–º–æ–π –≤ –±–ª–æ–∫–µ FROM –∏ –≤ JOIN: –µ—Å–ª–∏ —ç—Ç–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å, —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CTE –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–º—É –º–µ—Ç–æ–¥–æ–º `select` —ç—Ç–æ–π —Å—É—â–Ω–æ—Å—Ç–∏; –≤ –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ —Å —ç—Ç–∏–º –∏–º–µ–Ω–µ–º —Å–ª–µ–¥—É–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ —Å —Ç–∞–±–ª–∏—Ü–µ–π (–∏–ª–∏ –¥—Ä—É–≥–∏–º –æ–±—ä–µ–∫—Ç–æ–º –ø–æ–¥ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –°–£–ë–î, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ–º VIEW).

(9) –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–æ–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

(.1) –°–≤–µ–¥–µ–Ω–∏—è, —É–ø–æ–º—è–Ω—É—Ç—ã–µ –≤ —Ä–∞–∑–¥–µ–ª–∞—Ö (4), (5), (6) –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ –≤–Ω–µ—à–Ω–µ–º—É –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–Ω—è—Ç–∏–π. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è `select`, `read`, `save` –∏ `delete` –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω–æ–º–æ—á–∏–π –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, –∏ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º –∫—Ä–æ–º–µ –æ–¥–Ω–æ–≥–æ –≤–∞–∂–Ω–æ–≥–æ —á–∞—Å—Ç–Ω–æ–≥–æ —Å–ª—É—á–∞—è: –∫–æ–≥–¥–∞ `entity` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–±—ã—á–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ –°–£–ë–î (–∏–ª–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—é ‚Äì VIEW).
–í —ç—Ç–æ–º —á–∞—Å—Ç–Ω–æ–º —Å–ª—É—á–∞–µ –º–æ–∂–Ω–æ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é CRUD-–æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é (–≤ —Ç–æ–º —á–∏—Å–ª–µ `read` —á–µ—Ä–µ–∑ `select`), –∏ –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–ª–Ω–æ–º–æ—á–∏–π.

(.2) –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è `entity` –Ω—É–∂–Ω–∞, –Ω–æ —Å–ª–µ–¥—É–µ—Ç –æ–±–µ—Å–ø–µ—á–∏—Ç—å, —á—Ç–æ–±—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–ª–∞—Å—å —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä:
1) –ú—ã —Ö–æ—Ç–∏–º –æ–±–µ—Å–ø–µ—á–∏—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É `save` –∏–ª–∏ `delete`.
2) –ú—ã —Ö–æ—Ç–∏–º —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —á—Ç–æ–±—ã –µ–≥–æ –º–æ–∂–Ω–æ –±—ã–ª–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö ‚Äì –æ–±–µ—Å–ø–µ—á–∏—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é `select`.
3) –ú—ã —Ö–æ—Ç–∏–º –¥–æ–ø–æ–ª–Ω–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏, —Ä–∞–∑–º–µ—Å—Ç–∏–≤ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —Ç–∞–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ–±–µ—Å–ø–µ—á–∏—Ç—å –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—é).

–ß—Ç–æ –∫–∞—Å–∞–µ—Ç—Å—è –≤–∞–∂–Ω–æ–≥–æ —á–∞—Å—Ç–Ω–æ–≥–æ —Å–ª—É—á–∞—è, –∫–æ–≥–¥–∞ `entity` —è–≤–ª—è–µ—Ç—Å—è –æ–±—ã—á–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ–π, –¥–æ–ª–∂–µ–Ω –æ–±–µ—Å–ø–µ—á–∏–≤–∞—Ç—å—Å—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π fallback –Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é `select` –∏ CRUD-–æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é (`fallback`).

(.3) –í–æ–∑–º–æ–∂–Ω–æ, —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º (.2) —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ `entity` –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º –∫–ª–∞—Å—Å–∞, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –≤ —Ç–æ–º –æ–±—ä—ë–º–µ, –∫–æ—Ç–æ—Ä—ã–π —Å–æ—á—Ç—ë—Ç –Ω—É–∂–Ω—ã–º: –¥–æ–ø–æ–ª–Ω–∏—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, —Ä–µ–∞–ª–∏–∑—É–µ—Ç `select` –∏/–∏–ª–∏ CRUD-–æ–ø–µ—Ä–∞—Ü–∏–∏.
–í —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ, —á—Ç–æ–±—ã –∫–ª–∞—Å—Å –Ω–∞—á–∞–ª —Ä–∞–±–æ—Ç–∞—Ç—å, –æ–Ω –¥–æ–ª–∂–µ–Ω –±—É–¥–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ –ø–æ–¥ –∫–∞–∫–∏–º-—Ç–æ –∏–º–µ–Ω–µ–º. –ï—Å–ª–∏ –∏–º—è —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∏–º–µ–Ω–µ–º —Ä–µ–∞–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã, —Ç–æ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º–∞—è –Ω–∞–º–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–º–µ–Ω–Ω–æ —ç—Ç–æ—Ç –∫–ª–∞—Å—Å, –∞ –Ω–µ `fallback`. 
(.1) `entity` –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∞—Å—Å–æ–º.
‚Äî

–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ü–µ–Ω–∏ –∏–¥–µ—é, –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç –∫—Ä–∏—Ç–∏–∫–∞ –∏ —Ä–∏—Å–∫–∏.
–ü—Ä–µ–¥–ª–æ–∂–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é.
–ö–æ–¥ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–µ–Ω—É–∂–Ω–æ ‚Äì –Ω–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ –º—ã –ø—Ä–æ—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–æ–Ω—Ü–µ–ø—Ü–∏—é.


---

**Cursor**

–Ø –∏–∑—É—á—É –¥–æ–∫—É–º–µ–Ω—Ç —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É—é –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—É—é –∫–æ–Ω—Ü–µ–ø—Ü–∏—é. –î–∞–≤–∞–π—Ç–µ –Ω–∞—á–Ω–µ–º:

–ü—Ä–µ–∫—Ä–∞—Å–Ω–æ! –ò–∑—É—á–∏–ª –¥–æ–∫—É–º–µ–Ω—Ç —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –ø—Ä–æ–µ–∫—Ç–∞ UMA. –¢–µ–ø–µ—Ä—å –ø—Ä–æ—á–∏—Ç–∞—é –≤—Ç–æ—Ä–æ–π –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è –ø–æ–ª–Ω–æ—Ç—ã –∫–∞—Ä—Ç–∏–Ω—ã, –∑–∞—Ç–µ–º –æ–±–Ω–æ–≤–ª—é ConPort –∏ –¥–∞–º –æ—Ü–µ–Ω–∫—É –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–π –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏.

–û—Ç–ª–∏—á–Ω–æ, —è –∏–∑—É—á–∏–ª –¥–æ–∫—É–º–µ–Ω—Ç—ã. –¢–µ–ø–µ—Ä—å –æ–±–Ω–æ–≤–ª—é ConPort –∑–Ω–∞–Ω–∏—è–º–∏ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É—é –Ω–æ–≤—É—é –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—É—é –∫–æ–Ω—Ü–µ–ø—Ü–∏—é.

–û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É—é –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏–∑ –≤–∞—à–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞, –æ—Å–æ–±–µ–Ω–Ω–æ –≤ —á–∞—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (.2) –∏ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ –∫–ª–∞—Å—Å—ã (.3).

## –ê–Ω–∞–ª–∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–π –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

### –û—Ü–µ–Ω–∫–∞ –∏–¥–µ–∏

#### ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã

1. **–≠–ª–µ–≥–∞–Ω—Ç–Ω–æ–µ –æ–±–æ–±—â–µ–Ω–∏–µ**: –ö–æ–Ω—Ü–µ–ø—Ü–∏—è entity –∫–∞–∫ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –æ—á–µ–Ω—å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω–∞. –û–Ω–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ –æ–±–æ–±—â–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—ã, –∫–æ–º–ø–æ–∑–∏—Ç–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è.

2. **Fallback-—Å—Ç—Ä–∞—Ç–µ–≥–∏—è**: –ò–¥–µ—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ fallback –Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –æ–±—ã—á–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü ‚Äî –æ—Ç–ª–∏—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ. –≠—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç boilerplate –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å entity —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.

3. **–ü—Ä–∏–Ω—Ü–∏–ø opt-in**: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤ ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –ø—Ä–∏–Ω—Ü–∏–ø—É "convention over configuration".

4. **–ò–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è –ø–æ–ª–∏—Ç–∏–∫**: –†–∞–∑–º–µ—â–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞ –≤–Ω—É—Ç—Ä–∏ `select` entity ‚Äî —ç—Ç–æ —á–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, —É–ø—Ä–æ—â–∞—é—â–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å.

5. **–ì–∏–±–∫–æ—Å—Ç—å —á–µ—Ä–µ–∑ –∫–ª–∞—Å—Å—ã**: –ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ entity –∫–ª–∞—Å—Å–∞–º–∏ –¥–∞–µ—Ç –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è, –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–µ—Ç–æ–¥–æ–≤ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö.

### ‚ö†Ô∏è –ö—Ä–∏—Ç–∏–∫–∞ –∏ —Ä–∏—Å–∫–∏

#### 1. –ö–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω—ã–µ —Ä–∏—Å–∫–∏

**–†–∏—Å–∫: –ù–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ—Å—Ç—å –ø—Ä–∏—Ä–æ–¥—ã entity –ø—Ä–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–∏**

```python
# –í JSQL –∑–∞–ø—Ä–æ—Å–µ:
{"from": "users", "joins": [{"table": "orders", ...}]}

# –í–æ–ø—Ä–æ—Å—ã:
# - "users" - —ç—Ç–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è entity –∏–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ –ë–î?
# - "orders" - —ç—Ç–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è entity –∏–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ –ë–î?
# - –ß—Ç–æ –µ—Å–ª–∏ –µ—Å—Ç—å –∏ —Ç–∞–±–ª–∏—Ü–∞ "users" –∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è entity "users"?
```

**–†–µ—à–µ–Ω–∏–µ**: 
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: –µ—Å–ª–∏ entity –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Å –∏–º–µ–Ω–µ–º —Ç–∞–±–ª–∏—Ü—ã, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–Ω–∞, –∞ –Ω–µ fallback.
- –Ø–≤–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ: —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º registry, –ø–æ—Ç–æ–º metadata.tables.
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∏–º–µ–Ω –Ω—É–∂–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å.

**–†–∏—Å–∫: –°–ª–æ–∂–Ω–æ—Å—Ç—å fallback-–ª–æ–≥–∏–∫–∏**

–ö–æ–≥–¥–∞ entity –ù–ï –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞, –Ω–æ –∏–º—è —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ç–∞–±–ª–∏—Ü–µ–π –ë–î, –Ω—É–∂–Ω–æ:
- –°–æ–∑–¥–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—É—é entity "–Ω–∞ –ª–µ—Ç—É"
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–ª—è –Ω–µ–µ select/CRUD –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- –û–±–µ—Å–ø–µ—á–∏—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ (–Ω–æ –∫–∞–∫? —Ö—É–∫–∏ –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –∏ –¥–ª—è fallback!)

**–†–µ—à–µ–Ω–∏–µ**: 
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ —Ç–∞–±–ª–∏—Ü–µ –ë–î
- Lazy initialization: entity —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏
- –•—É–∫–∏ –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞ –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ –¥–ª—è —è–≤–Ω—ã—Ö –∏ –Ω–µ—è–≤–Ω—ã—Ö entity

#### 2. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∏—Å–∫–∏

**–†–∏—Å–∫: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞**

```python
# –ü—Ä–∏ –∫–∞–∂–¥–æ–º read():
def read(id):
    # 1. –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è select —Å —É—Å–ª–æ–≤–∏–µ–º –ø–æ id
    # 2. –ï—Å–ª–∏ select –Ω–∏—á–µ–≥–æ –Ω–µ –≤–µ—Ä–Ω—É–ª - –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞
    # –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ –ë–î –¥–ª—è –ö–ê–ñ–î–û–ô –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞!
```

**–†–µ—à–µ–Ω–∏–µ**:
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞ (—Å —É—á–µ—Ç–æ–º user_context)
- Batch-–ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö read
- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —á–µ—Ä–µ–∑ select –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–†–∏—Å–∫: –ö–æ–º–ø–æ–∑–∏—Ç–Ω—ã–µ entity –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**

```python
# save –¥–ª—è –∫–æ–º–ø–æ–∑–∏—Ç–Ω–æ–π entity:
entity = {"user_id": 123, "name": "John", "bio": "Developer", "avatar_url": "..."}
# –ù—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ users –∏ profiles –∞—Ç–æ–º–∞—Ä–Ω–æ
# –ß—Ç–æ –µ—Å–ª–∏ users.save –ø—Ä–æ—à–µ–ª, –∞ profiles.save —É–ø–∞–ª?
```

**–†–µ—à–µ–Ω–∏–µ**:
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –¥–ª—è –∫–æ–º–ø–æ–∑–∏—Ç–Ω—ã—Ö entity
- –Ø–≤–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞ rollback
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ savepoints –¥–ª—è –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

**–†–∏—Å–∫: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã select –∏ –∏—Ö –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏**

```python
# Entity —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ params:
class RestrictedOrders(Entity):
    def select(self, params):
        return select(...).where(orders.c.user_id == params.get("user_id"))

# –ù–æ —á—Ç–æ –µ—Å–ª–∏ —ç—Ç–∞ entity –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ JOIN?
{"from": "users", "joins": [{"table": "restricted_orders"}]}
# –û—Ç–∫—É–¥–∞ –≤–æ–∑—å–º—É—Ç—Å—è params –¥–ª—è restricted_orders?
```

**–†–µ—à–µ–Ω–∏–µ**:
- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ params –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤—Å–µ–º entity –≤ –∑–∞–ø—Ä–æ—Å–µ
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–∫–∞–∑–∞—Ç—å params –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π entity —á–µ—Ä–µ–∑ –∞–ª–∏–∞—Å—ã
- –Ø–≤–Ω–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ required params –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö entity

#### 3. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–∏—Å–∫–∏

**–†–∏—Å–∫: –¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ entity**

```python
# Entity A –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Entity B –≤ select
# Entity B –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Entity A –≤ select
# –ö–∞–∫ —Ä–∞–∑—Ä–µ—à–∞—Ç—å —Ç–∞–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏?
```

**–†–µ—à–µ–Ω–∏–µ**:
- –ì—Ä–∞—Ñ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ü–∏–∫–ª–æ–≤ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- –ó–∞–ø—Ä–µ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≥–ª—É–±–∏–Ω—ã —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
- Lazy evaluation –¥–ª—è –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

**–†–∏—Å–∫: –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ entity –∏ –∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫**

–î–ª—è fallback entity (–æ–±—ã—á–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã) –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∏–∑ –ë–î —á–µ—Ä–µ–∑ –∏–Ω—Ç—Ä–æ—Å–ø–µ–∫—Ü–∏—é. –ù–æ:
- Description –ø–æ–ª–µ–π –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ –°–£–ë–î
- –ö–∞—Å—Ç–æ–º–Ω—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –≤–µ—Ä—Å–∏–∏) –Ω—É–∂–Ω–æ –æ—Ç–∫—É–¥–∞-—Ç–æ –±—Ä–∞—Ç—å

**–†–µ—à–µ–Ω–∏–µ**:
- –î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö: –±–∞–∑–æ–≤—ã–µ (–∏–∑ –ë–î) + —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ (–∏–∑ registry)
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ fallback entity —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–π API
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ COMMENT –≤ DDL –¥–ª—è description (–¥–ª—è PostgreSQL/MySQL)

### üí° –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

#### –£–ª—É—á—à–µ–Ω–∏–µ 1: –Ø–≤–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ read-only –∏ CRUD

```python
class Entity:
    """–ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –≤—Å–µ—Ö entity"""
    readonly: bool = False  # –Ø–≤–Ω—ã–π —Ñ–ª–∞–≥
    
class ReadOnlyEntity(Entity):
    """–ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è readonly entity"""
    readonly: bool = True
    
    # save –∏ delete –∑–∞–ø—Ä–µ—â–µ–Ω—ã
    def save(self, data):
        raise NotImplementedError("This entity is read-only")
```

#### –£–ª—É—á—à–µ–Ω–∏–µ 2: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ partial updates

```python
# –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è:
save(entity_name, {"id": 123, "name": "John", "email": "..."})
# –í—Å–µ –ø–æ–ª—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–µ—Ä–µ–¥–∞–Ω—ã?

# –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:
save(entity_name, {"id": 123, "email": "new@example.com"}, partial=True)
# –û–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –ø–æ–ª—è
```

#### –£–ª—É—á—à–µ–Ω–∏–µ 3: –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Ö—É–∫–∏

```python
class Entity:
    def validate_before_save(self, data: OrderedDict) -> list[str]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏"""
        return []
    
    def before_save(self, data: OrderedDict) -> OrderedDict:
        """–•—É–∫ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º (–º–æ–∂–Ω–æ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ)"""
        return data
    
    def after_save(self, id: Any, data: OrderedDict):
        """–•—É–∫ –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (–¥–ª—è –∞—É–¥–∏—Ç–∞, –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–π)"""
        pass
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Å–æ–≤ Entity

```python
# –ë–∞–∑–æ–≤—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª (–Ω–µ –∫–ª–∞—Å—Å, –∞ typing.Protocol –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏)

from typing import Protocol, Any, Optional
from collections import OrderedDict
from sqlalchemy import Select

class EntityProtocol(Protocol):
    """–ü—Ä–æ—Ç–æ–∫–æ–ª, –∫–æ—Ç–æ—Ä–æ–º—É –¥–æ–ª–∂–Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å entity"""
    
    name: str  # –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è
    description: str
    
    def select(self, params: dict[str, Any]) -> Select:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç SQLAlchemy Select –¥–ª—è –≤—ã–±–æ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö"""
        ...
    
    def read(self, id_value: Any, user_context: Any) -> Optional[dict]:
        """–ß–∏—Ç–∞–µ—Ç –æ–¥–Ω—É –∑–∞–ø–∏—Å—å –ø–æ id"""
        ...
    
    def save(self, data: OrderedDict, user_context: Any) -> Any:
        """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∑–∞–ø–∏—Å—å (create –∏–ª–∏ update)"""
        ...
    
    def delete(self, id_value: Any, user_context: Any) -> bool:
        """–£–¥–∞–ª—è–µ—Ç –∑–∞–ø–∏—Å—å"""
        ...


# –ë–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è Entity

class Entity:
    """
    –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è entity.
    –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç fallback-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Ç–∞–±–ª–∏—Ü.
    """
    
    # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –≤ –ø–æ–¥–∫–ª–∞—Å—Å–∞—Ö)
    name: str
    description: str = ""
    table_name: Optional[str] = None  # –ò–º—è —Ç–∞–±–ª–∏—Ü—ã –ë–î (–µ—Å–ª–∏ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç name)
    id_field: str | tuple[str, ...] = "id"
    readonly: bool = False
    
    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    metadata: dict[str, Any] = {}
    
    def __init__(self, engine, metadata_obj):
        """
        engine: SQLAlchemy Engine
        metadata_obj: SQLAlchemy MetaData (–æ—Ç—Ä–µ—Ñ–ª–µ–∫—á–µ–Ω–Ω—ã–π)
        """
        self.engine = engine
        self.metadata_obj = metadata_obj
        self._table = None  # –ö—ç—à –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã
    
    @property
    def table(self):
        """–õ–µ–Ω–∏–≤–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ Table –∏–∑ MetaData"""
        if self._table is None:
            table_name = self.table_name or self.name
            self._table = self.metadata_obj.tables[table_name]
        return self._table
    
    def select(self, params: dict[str, Any]) -> Select:
        """
        Fallback —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è: SELECT * FROM table
        –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –≤ –ø–æ–¥–∫–ª–∞—Å—Å–∞—Ö –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ–π –ª–æ–≥–∏–∫–∏ –∏ –ø–æ–ª–∏—Ç–∏–∫ –¥–æ—Å—Ç—É–ø–∞
        """
        from sqlalchemy import select
        return select(self.table)
    
    def read(self, id_value: Any, user_context: Any) -> Optional[dict]:
        """
        Fallback —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ select
        """
        from sqlalchemy import select
        
        # –ü–æ–ª—É—á–∞–µ–º select —Å –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞
        query = self.select({})
        
        # –î–æ–±–∞–≤–ª—è–µ–º —É—Å–ª–æ–≤–∏–µ –ø–æ id
        id_condition = self._build_id_condition(id_value)
        query = query.where(id_condition)
        
        # –í—ã–ø–æ–ª–Ω—è–µ–º
        with self.engine.connect() as conn:
            result = conn.execute(query).mappings().first()
            return dict(result) if result else None
    
    def save(self, data: OrderedDict, user_context: Any) -> Any:
        """
        Fallback —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Ç–∞–±–ª–∏—Ü
        """
        if self.readonly:
            raise ValueError(f"Entity {self.name} is read-only")
        
        from sqlalchemy import insert, update
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º create vs update
        id_value = self._extract_id(data)
        is_create = (id_value is None)
        
        with self.engine.begin() as conn:  # –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è
            if is_create:
                # INSERT
                stmt = insert(self.table).values(**data)
                result = conn.execute(stmt)
                return result.inserted_primary_key[0]
            else:
                # UPDATE
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ read
                existing = self.read(id_value, user_context)
                if existing is None:
                    raise PermissionError(f"No access to update {self.name}:{id_value}")
                
                id_condition = self._build_id_condition(id_value)
                stmt = update(self.table).where(id_condition).values(**data)
                conn.execute(stmt)
                return id_value
    
    def delete(self, id_value: Any, user_context: Any) -> bool:
        """
        Fallback —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Ç–∞–±–ª–∏—Ü
        """
        if self.readonly:
            raise ValueError(f"Entity {self.name} is read-only")
        
        from sqlalchemy import delete as sql_delete
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ read
        existing = self.read(id_value, user_context)
        if existing is None:
            raise PermissionError(f"No access to delete {self.name}:{id_value}")
        
        with self.engine.begin() as conn:
            id_condition = self._build_id_condition(id_value)
            stmt = sql_delete(self.table).where(id_condition)
            result = conn.execute(stmt)
            return result.rowcount > 0
    
    def _build_id_condition(self, id_value: Any):
        """–°—Ç—Ä–æ–∏—Ç —É—Å–ª–æ–≤–∏–µ –¥–ª—è id (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–æ—Å—Ç–∞–≤–Ω—ã—Ö –∫–ª—é—á–µ–π)"""
        if isinstance(self.id_field, str):
            return self.table.c[self.id_field] == id_value
        else:
            # –°–æ—Å—Ç–∞–≤–Ω–æ–π –∫–ª—é—á
            conditions = [
                self.table.c[field] == value
                for field, value in zip(self.id_field, id_value)
            ]
            from sqlalchemy import and_
            return and_(*conditions)
    
    def _extract_id(self, data: OrderedDict) -> Any:
        """–ò–∑–≤–ª–µ–∫–∞–µ—Ç id –∏–∑ –¥–∞–Ω–Ω—ã—Ö"""
        if isinstance(self.id_field, str):
            return data.get(self.id_field)
        else:
            return tuple(data.get(field) for field in self.id_field)


# –ü—Ä–∏–º–µ—Ä –∫–∞—Å—Ç–æ–º–Ω–æ–π entity —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –¥–æ—Å—Ç—É–ø–∞

class RestrictedUsers(Entity):
    """Entity —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –¥–æ—Å—Ç—É–ø–∞: —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏"""
    
    name = "users"
    description = "–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã"
    
    def select(self, params: dict[str, Any]) -> Select:
        """–ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º select –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª–∏—Ç–∏–∫–∏"""
        from sqlalchemy import select
        query = select(self.table).where(self.table.c.active == True)
        
        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏–∑ params
        if "department_id" in params:
            query = query.where(self.table.c.department_id == params["department_id"])
        
        return query


# –ö–æ–º–ø–æ–∑–∏—Ç–Ω–∞—è entity

class UserProfile(Entity):
    """–ö–æ–º–ø–æ–∑–∏—Ç–Ω–∞—è entity: users + profiles"""
    
    name = "user_profile"
    description = "–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏"
    id_field = "user_id"
    
    def select(self, params: dict[str, Any]) -> Select:
        from sqlalchemy import select
        
        users = self.metadata_obj.tables["users"]
        profiles = self.metadata_obj.tables["profiles"]
        
        return select(
            users.c.id.label("user_id"),
            users.c.name,
            users.c.email,
            profiles.c.bio,
            profiles.c.avatar_url
        ).select_from(
            users.join(profiles, users.c.id == profiles.c.user_id)
        )
    
    def save(self, data: OrderedDict, user_context: Any) -> Any:
        """–ö–∞—Å—Ç–æ–º–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∞–±–ª–∏—Ü"""
        from sqlalchemy import insert, update
        
        user_id = data.get("user_id")
        is_create = (user_id is None)
        
        users = self.metadata_obj.tables["users"]
        profiles = self.metadata_obj.tables["profiles"]
        
        with self.engine.begin() as conn:  # –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è!
            if is_create:
                # –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                user_data = {"name": data["name"], "email": data["email"]}
                result = conn.execute(insert(users).values(**user_data))
                user_id = result.inserted_primary_key[0]
                
                # –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å
                profile_data = {
                    "user_id": user_id,
                    "bio": data.get("bio"),
                    "avatar_url": data.get("avatar_url")
                }
                conn.execute(insert(profiles).values(**profile_data))
            else:
                # –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                user_data = {"name": data["name"], "email": data["email"]}
                conn.execute(
                    update(users).where(users.c.id == user_id).values(**user_data)
                )
                
                # –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å
                profile_data = {"bio": data.get("bio"), "avatar_url": data.get("avatar_url")}
                conn.execute(
                    update(profiles).where(profiles.c.user_id == user_id).values(**profile_data)
                )
            
            return user_id
```

### 2. Entity Registry —Å fallback

```python
class EntityRegistry:
    """
    –†–µ–µ—Å—Ç—Ä entity —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º fallback –Ω–∞ —Ç–∞–±–ª–∏—Ü—ã –ë–î
    """
    
    def __init__(self, engine, metadata_obj):
        self.engine = engine
        self.metadata_obj = metadata_obj
        self._registry: dict[str, Entity] = {}
        self._auto_entities: dict[str, Entity] = {}  # –ö—ç—à –¥–ª—è fallback entity
    
    def register(self, entity_class: type[Entity]):
        """–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç entity"""
        entity = entity_class(self.engine, self.metadata_obj)
        
        if entity.name in self._registry:
            raise ValueError(f"Entity {entity.name} already registered")
        
        self._registry[entity.name] = entity
        return entity
    
    def get(self, name: str) -> Entity:
        """
        –ü–æ–ª—É—á–∞–µ—Ç entity –ø–æ –∏–º–µ–Ω–∏.
        –ï—Å–ª–∏ –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞, –Ω–æ –µ—Å—Ç—å —Ç–∞–±–ª–∏—Ü–∞ —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º - —Å–æ–∑–¥–∞–µ—Ç fallback entity.
        """
        # 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º —è–≤–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ
        if name in self._registry:
            return self._registry[name]
        
        # 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à auto-entity
        if name in self._auto_entities:
            return self._auto_entities[name]
        
        # 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∞–±–ª–∏—Ü—ã –ë–î
        if name in self.metadata_obj.tables:
            # –°–æ–∑–¥–∞–µ–º fallback entity
            auto_entity = self._create_auto_entity(name)
            self._auto_entities[name] = auto_entity
            return auto_entity
        
        raise ValueError(f"Entity or table '{name}' not found")
    
    def _create_auto_entity(self, table_name: str) -> Entity:
        """–°–æ–∑–¥–∞–µ—Ç fallback entity –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –ë–î"""
        
        # –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ–º –∫–ª–∞—Å—Å
        entity_class = type(
            f"Auto_{table_name}",
            (Entity,),
            {
                "name": table_name,
                "table_name": table_name,
                "description": f"Auto-generated entity for table {table_name}"
            }
        )
        
        return entity_class(self.engine, self.metadata_obj)
    
    def list_all(self) -> list[str]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö entity (–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ + —Ç–∞–±–ª–∏—Ü—ã)"""
        registered = set(self._registry.keys())
        tables = set(self.metadata_obj.tables.keys())
        return sorted(registered | tables)
    
    def is_registered(self, name: str) -> bool:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ entity —è–≤–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π"""
        return name in self._registry
```

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å JSQL Parser

```python
def parse_jsql_with_entities(jsql: dict, params: dict[str, Any], registry: EntityRegistry) -> Select:
    """
    –ü–∞—Ä—Å–∏—Ç JSQL —Å —É—á–µ—Ç–æ–º –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö entity
    """
    from_name = jsql["from"]
    
    # –ü–æ–ª—É—á–∞–µ–º entity (—è–≤–Ω—É—é –∏–ª–∏ fallback)
    entity = registry.get(from_name)
    
    # –ï—Å–ª–∏ entity —è–≤–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–µ select –∫–∞–∫ CTE
    if registry.is_registered(from_name):
        entity_select = entity.select(params)
        entity_cte = entity_select.cte(name=from_name)
        base_selectable = entity_cte
    else:
        # Fallback: –æ–±—ã—á–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
        base_selectable = entity.table
    
    # –°—Ç—Ä–æ–∏–º –æ—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ø—Ä–æ—Å
    query = build_query_from_jsql(jsql, base_selectable, registry, params)
    
    return query
```

### 4. API —Ñ—É–Ω–∫—Ü–∏–∏ UMA

```python
# –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ UMA

def uma_select(jsql: dict, params: dict[str, Any] = None, user_context: Any = None) -> dict:
    """
    –í—ã–ø–æ–ª–Ω—è–µ—Ç JSQL –∑–∞–ø—Ä–æ—Å
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: {"metadata": {...}, "data": [...]}
    """
    pass

def uma_read(entity_name: str, id_value: Any, user_context: Any = None) -> Optional[dict]:
    """
    –ß–∏—Ç–∞–µ—Ç –æ–¥–Ω—É –∑–∞–ø–∏—Å—å entity –ø–æ id
    """
    entity = registry.get(entity_name)
    return entity.read(id_value, user_context)

def uma_save(entity_name: str, data: OrderedDict, user_context: Any = None) -> Any:
    """
    –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∑–∞–ø–∏—Å—å entity (create –∏–ª–∏ update)
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç id —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –∑–∞–ø–∏—Å–∏
    """
    entity = registry.get(entity_name)
    return entity.save(data, user_context)

def uma_delete(entity_name: str, id_value: Any, user_context: Any = None) -> bool:
    """
    –£–¥–∞–ª—è–µ—Ç –∑–∞–ø–∏—Å—å entity
    """
    entity = registry.get(entity_name)
    return entity.delete(id_value, user_context)

def uma_meta_tables(user_context: Any = None) -> list[dict]:
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö entity/—Ç–∞–±–ª–∏—Ü
    """
    pass

def uma_meta_details(entity_name: str, user_context: Any = None) -> dict:
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—è—Ö entity
    """
    pass
```

### 5. –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```python
from sqlalchemy import create_engine, MetaData

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
engine = create_engine("postgresql://...")
metadata = MetaData()
metadata.reflect(bind=engine)

# –°–æ–∑–¥–∞–µ–º registry
registry = EntityRegistry(engine, metadata)

# –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–µ entity (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏!)
registry.register(RestrictedUsers)
registry.register(UserProfile)

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
# 1. –û–±—ã—á–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ (fallback)
result = uma_read("orders", 123, user_context=current_user)

# 2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è entity —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π
result = uma_read("users", 456, user_context=current_user)  # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç RestrictedUsers

# 3. –ö–æ–º–ø–æ–∑–∏—Ç–Ω–∞—è entity
profile = uma_read("user_profile", 456, user_context=current_user)
profile["bio"] = "New bio"
uma_save("user_profile", profile, user_context=current_user)

# 4. JSQL –∑–∞–ø—Ä–æ—Å —Å entity
jsql = {
    "select": ["users.id", "users.name", "orders.total"],
    "from": "users",  # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç RestrictedUsers (–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞)
    "joins": [{
        "type": "left",
        "table": "orders",  # –û–±—ã—á–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ (fallback)
        "on": {"users.id": "orders.user_id"}
    }]
}
result = uma_select(jsql, params={}, user_context=current_user)
```

## –ò—Ç–æ–≥–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ:

1. **Fallback-—Å—Ç—Ä–∞—Ç–µ–≥–∏—è** ‚Äî –æ—Ç–ª–∏—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ, –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç boilerplate
2. **–ö–ª–∞—Å—Å—ã –¥–ª—è entity** ‚Äî –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏
3. **–ï–¥–∏–Ω–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è** ‚Äî —É–ø—Ä–æ—â–∞–µ—Ç –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
4. **–ò–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è –ø–æ–ª–∏—Ç–∏–∫** ‚Äî —á–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### ‚ö†Ô∏è –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å:

1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–æ–∫** ‚Äî –Ω—É–∂–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
2. **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å** ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –¥–ª—è –∫–æ–º–ø–æ–∑–∏—Ç–Ω—ã—Ö entity
3. **–í–∞–ª–∏–¥–∞—Ü–∏—è** ‚Äî –Ω—É–∂–Ω—ã —Ö—É–∫–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ save
4. **–¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** ‚Äî –Ω—É–∂–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

### üöÄ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è roadmap:

1. **–§–∞–∑–∞ 1**: –ë–∞–∑–æ–≤—ã–π Entity + fallback + registry
2. **–§–∞–∑–∞ 2**: –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è select + –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å JSQL
3. **–§–∞–∑–∞ 3**: CRUD –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Ç–∞–±–ª–∏—Ü
4. **–§–∞–∑–∞ 4**: –ö–æ–º–ø–æ–∑–∏—Ç–Ω—ã–µ entity + —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
5. **–§–∞–∑–∞ 5**: –•—É–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ –∞—É–¥–∏—Ç–∞

–ö–æ–Ω—Ü–µ–ø—Ü–∏—è **–∂–∏–∑–Ω–µ—Å–ø–æ—Å–æ–±–Ω–∞** –∏ —ç–ª–µ–≥–∞–Ω—Ç–Ω–∞! –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∏—Å–∫–∏ —É–ø—Ä–∞–≤–ª—è–µ–º—ã –ø—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

```python
# –í JSQL –∑–∞–ø—Ä–æ—Å–µ:
{"from": "users", "joins": [{"table": "orders", ...}]}

# –í–æ–ø—Ä–æ—Å—ã:
# - "users" - —ç—Ç–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è entity –∏–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ –ë–î?
# - "orders" - —ç—Ç–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è entity –∏–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ –ë–î?
# - –ß—Ç–æ –µ—Å–ª–∏ –µ—Å—Ç—å –∏ —Ç–∞–±–ª–∏—Ü–∞ "users" –∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è entity "users"?
```

```python
# –ü—Ä–∏ –∫–∞–∂–¥–æ–º read():
def read(id):
    # 1. –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è select —Å —É—Å–ª–æ–≤–∏–µ–º –ø–æ id
    # 2. –ï—Å–ª–∏ select –Ω–∏—á–µ–≥–æ –Ω–µ –≤–µ—Ä–Ω—É–ª - –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞
    # –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ –ë–î –¥–ª—è –ö–ê–ñ–î–û–ô –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞!
```

```python
# save –¥–ª—è –∫–æ–º–ø–æ–∑–∏—Ç–Ω–æ–π entity:
entity = {"user_id": 123, "name": "John", "bio": "Developer", "avatar_url": "..."}
# –ù—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ users –∏ profiles –∞—Ç–æ–º–∞—Ä–Ω–æ
# –ß—Ç–æ –µ—Å–ª–∏ users.save –ø—Ä–æ—à–µ–ª, –∞ profiles.save —É–ø–∞–ª?
```

```python
# Entity —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ params:
class RestrictedOrders(Entity):
    def select(self, params):
        return select(...).where(orders.c.user_id == params.get("user_id"))

# –ù–æ —á—Ç–æ –µ—Å–ª–∏ —ç—Ç–∞ entity –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ JOIN?
{"from": "users", "joins": [{"table": "restricted_orders"}]}
# –û—Ç–∫—É–¥–∞ –≤–æ–∑—å–º—É—Ç—Å—è params –¥–ª—è restricted_orders?
```

```python
# Entity A –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Entity B –≤ select
# Entity B –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Entity A –≤ select
# –ö–∞–∫ —Ä–∞–∑—Ä–µ—à–∞—Ç—å —Ç–∞–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏?
```

```python
class Entity:
    """–ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –≤—Å–µ—Ö entity"""
    readonly: bool = False  # –Ø–≤–Ω—ã–π —Ñ–ª–∞–≥
    
class ReadOnlyEntity(Entity):
    """–ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è readonly entity"""
    readonly: bool = True
    
    # save –∏ delete –∑–∞–ø—Ä–µ—â–µ–Ω—ã
    def save(self, data):
        raise NotImplementedError("This entity is read-only")
```

```python
# –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è:
save(entity_name, {"id": 123, "name": "John", "email": "..."})
# –í—Å–µ –ø–æ–ª—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–µ—Ä–µ–¥–∞–Ω—ã?

# –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:
save(entity_name, {"id": 123, "email": "new@example.com"}, partial=True)
# –û–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –ø–æ–ª—è
```

```python
class Entity:
    def validate_before_save(self, data: OrderedDict) -> list[str]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏"""
        return []
    
    def before_save(self, data: OrderedDict) -> OrderedDict:
        """–•—É–∫ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º (–º–æ–∂–Ω–æ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ)"""
        return data
    
    def after_save(self, id: Any, data: OrderedDict):
        """–•—É–∫ –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (–¥–ª—è –∞—É–¥–∏—Ç–∞, –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–π)"""
        pass
```

```python
# –ë–∞–∑–æ–≤—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª (–Ω–µ –∫–ª–∞—Å—Å, –∞ typing.Protocol –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏)

from typing import Protocol, Any, Optional
from collections import OrderedDict
from sqlalchemy import Select

class EntityProtocol(Protocol):
    """–ü—Ä–æ—Ç–æ–∫–æ–ª, –∫–æ—Ç–æ—Ä–æ–º—É –¥–æ–ª–∂–Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å entity"""
    
    name: str  # –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è
    description: str
    
    def select(self, params: dict[str, Any]) -> Select:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç SQLAlchemy Select –¥–ª—è –≤—ã–±–æ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö"""
        ...
    
    def read(self, id_value: Any, user_context: Any) -> Optional[dict]:
        """–ß–∏—Ç–∞–µ—Ç –æ–¥–Ω—É –∑–∞–ø–∏—Å—å –ø–æ id"""
        ...
    
    def save(self, data: OrderedDict, user_context: Any) -> Any:
        """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∑–∞–ø–∏—Å—å (create –∏–ª–∏ update)"""
        ...
    
    def delete(self, id_value: Any, user_context: Any) -> bool:
        """–£–¥–∞–ª—è–µ—Ç –∑–∞–ø–∏—Å—å"""
        ...


# –ë–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è Entity

class Entity:
    """
    –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è entity.
    –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç fallback-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Ç–∞–±–ª–∏—Ü.
    """
    
    # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –≤ –ø–æ–¥–∫–ª–∞—Å—Å–∞—Ö)
    name: str
    description: str = ""
    table_name: Optional[str] = None  # –ò–º—è —Ç–∞–±–ª–∏—Ü—ã –ë–î (–µ—Å–ª–∏ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç name)
    id_field: str | tuple[str, ...] = "id"
    readonly: bool = False
    
    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    metadata: dict[str, Any] = {}
    
    def __init__(self, engine, metadata_obj):
        """
        engine: SQLAlchemy Engine
        metadata_obj: SQLAlchemy MetaData (–æ—Ç—Ä–µ—Ñ–ª–µ–∫—á–µ–Ω–Ω—ã–π)
        """
        self.engine = engine
        self.metadata_obj = metadata_obj
        self._table = None  # –ö—ç—à –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã
    
    @property
    def table(self):
        """–õ–µ–Ω–∏–≤–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ Table –∏–∑ MetaData"""
        if self._table is None:
            table_name = self.table_name or self.name
            self._table = self.metadata_obj.tables[table_name]
        return self._table
    
    def select(self, params: dict[str, Any]) -> Select:
        """
        Fallback —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è: SELECT * FROM table
        –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –≤ –ø–æ–¥–∫–ª–∞—Å—Å–∞—Ö –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ–π –ª–æ–≥–∏–∫–∏ –∏ –ø–æ–ª–∏—Ç–∏–∫ –¥–æ—Å—Ç—É–ø–∞
        """
        from sqlalchemy import select
        return select(self.table)
    
    def read(self, id_value: Any, user_context: Any) -> Optional[dict]:
        """
        Fallback —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ select
        """
        from sqlalchemy import select
        
        # –ü–æ–ª—É—á–∞–µ–º select —Å –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞
        query = self.select({})
        
        # –î–æ–±–∞–≤–ª—è–µ–º —É—Å–ª–æ–≤–∏–µ –ø–æ id
        id_condition = self._build_id_condition(id_value)
        query = query.where(id_condition)
        
        # –í—ã–ø–æ–ª–Ω—è–µ–º
        with self.engine.connect() as conn:
            result = conn.execute(query).mappings().first()
            return dict(result) if result else None
    
    def save(self, data: OrderedDict, user_context: Any) -> Any:
        """
        Fallback —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Ç–∞–±–ª–∏—Ü
        """
        if self.readonly:
            raise ValueError(f"Entity {self.name} is read-only")
        
        from sqlalchemy import insert, update
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º create vs update
        id_value = self._extract_id(data)
        is_create = (id_value is None)
        
        with self.engine.begin() as conn:  # –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è
            if is_create:
                # INSERT
                stmt = insert(self.table).values(**data)
                result = conn.execute(stmt)
                return result.inserted_primary_key[0]
            else:
                # UPDATE
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ read
                existing = self.read(id_value, user_context)
                if existing is None:
                    raise PermissionError(f"No access to update {self.name}:{id_value}")
                
                id_condition = self._build_id_condition(id_value)
                stmt = update(self.table).where(id_condition).values(**data)
                conn.execute(stmt)
                return id_value
    
    def delete(self, id_value: Any, user_context: Any) -> bool:
        """
        Fallback —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Ç–∞–±–ª–∏—Ü
        """
        if self.readonly:
            raise ValueError(f"Entity {self.name} is read-only")
        
        from sqlalchemy import delete as sql_delete
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ read
        existing = self.read(id_value, user_context)
        if existing is None:
            raise PermissionError(f"No access to delete {self.name}:{id_value}")
        
        with self.engine.begin() as conn:
            id_condition = self._build_id_condition(id_value)
            stmt = sql_delete(self.table).where(id_condition)
            result = conn.execute(stmt)
            return result.rowcount > 0
    
    def _build_id_condition(self, id_value: Any):
        """–°—Ç—Ä–æ–∏—Ç —É—Å–ª–æ–≤–∏–µ –¥–ª—è id (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–æ—Å—Ç–∞–≤–Ω—ã—Ö –∫–ª—é—á–µ–π)"""
        if isinstance(self.id_field, str):
            return self.table.c[self.id_field] == id_value
        else:
            # –°–æ—Å—Ç–∞–≤–Ω–æ–π –∫–ª—é—á
            conditions = [
                self.table.c[field] == value
                for field, value in zip(self.id_field, id_value)
            ]
            from sqlalchemy import and_
            return and_(*conditions)
    
    def _extract_id(self, data: OrderedDict) -> Any:
        """–ò–∑–≤–ª–µ–∫–∞–µ—Ç id –∏–∑ –¥–∞–Ω–Ω—ã—Ö"""
        if isinstance(self.id_field, str):
            return data.get(self.id_field)
        else:
            return tuple(data.get(field) for field in self.id_field)


# –ü—Ä–∏–º–µ—Ä –∫–∞—Å—Ç–æ–º–Ω–æ–π entity —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –¥–æ—Å—Ç—É–ø–∞

class RestrictedUsers(Entity):
    """Entity —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –¥–æ—Å—Ç—É–ø–∞: —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏"""
    
    name = "users"
    description = "–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã"
    
    def select(self, params: dict[str, Any]) -> Select:
        """–ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º select –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª–∏—Ç–∏–∫–∏"""
        from sqlalchemy import select
        query = select(self.table).where(self.table.c.active == True)
        
        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏–∑ params
        if "department_id" in params:
            query = query.where(self.table.c.department_id == params["department_id"])
        
        return query


# –ö–æ–º–ø–æ–∑–∏—Ç–Ω–∞—è entity

class UserProfile(Entity):
    """–ö–æ–º–ø–æ–∑–∏—Ç–Ω–∞—è entity: users + profiles"""
    
    name = "user_profile"
    description = "–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏"
    id_field = "user_id"
    
    def select(self, params: dict[str, Any]) -> Select:
        from sqlalchemy import select
        
        users = self.metadata_obj.tables["users"]
        profiles = self.metadata_obj.tables["profiles"]
        
        return select(
            users.c.id.label("user_id"),
            users.c.name,
            users.c.email,
            profiles.c.bio,
            profiles.c.avatar_url
        ).select_from(
            users.join(profiles, users.c.id == profiles.c.user_id)
        )
    
    def save(self, data: OrderedDict, user_context: Any) -> Any:
        """–ö–∞—Å—Ç–æ–º–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∞–±–ª–∏—Ü"""
        from sqlalchemy import insert, update
        
        user_id = data.get("user_id")
        is_create = (user_id is None)
        
        users = self.metadata_obj.tables["users"]
        profiles = self.metadata_obj.tables["profiles"]
        
        with self.engine.begin() as conn:  # –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è!
            if is_create:
                # –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                user_data = {"name": data["name"], "email": data["email"]}
                result = conn.execute(insert(users).values(**user_data))
                user_id = result.inserted_primary_key[0]
                
                # –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å
                profile_data = {
                    "user_id": user_id,
                    "bio": data.get("bio"),
                    "avatar_url": data.get("avatar_url")
                }
                conn.execute(insert(profiles).values(**profile_data))
            else:
                # –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                user_data = {"name": data["name"], "email": data["email"]}
                conn.execute(
                    update(users).where(users.c.id == user_id).values(**user_data)
                )
                
                # –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å
                profile_data = {"bio": data.get("bio"), "avatar_url": data.get("avatar_url")}
                conn.execute(
                    update(profiles).where(profiles.c.user_id == user_id).values(**profile_data)
                )
            
            return user_id
```

```python
class EntityRegistry:
    """
    –†–µ–µ—Å—Ç—Ä entity —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º fallback –Ω–∞ —Ç–∞–±–ª–∏—Ü—ã –ë–î
    """
    
    def __init__(self, engine, metadata_obj):
        self.engine = engine
        self.metadata_obj = metadata_obj
        self._registry: dict[str, Entity] = {}
        self._auto_entities: dict[str, Entity] = {}  # –ö—ç—à –¥–ª—è fallback entity
    
    def register(self, entity_class: type[Entity]):
        """–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç entity"""
        entity = entity_class(self.engine, self.metadata_obj)
        
        if entity.name in self._registry:
            raise ValueError(f"Entity {entity.name} already registered")
        
        self._registry[entity.name] = entity
        return entity
    
    def get(self, name: str) -> Entity:
        """
        –ü–æ–ª—É—á–∞–µ—Ç entity –ø–æ –∏–º–µ–Ω–∏.
        –ï—Å–ª–∏ –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞, –Ω–æ –µ—Å—Ç—å —Ç–∞–±–ª–∏—Ü–∞ —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º - —Å–æ–∑–¥–∞–µ—Ç fallback entity.
        """
        # 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º —è–≤–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ
        if name in self._registry:
            return self._registry[name]
        
        # 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à auto-entity
        if name in self._auto_entities:
            return self._auto_entities[name]
        
        # 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∞–±–ª–∏—Ü—ã –ë–î
        if name in self.metadata_obj.tables:
            # –°–æ–∑–¥–∞–µ–º fallback entity
            auto_entity = self._create_auto_entity(name)
            self._auto_entities[name] = auto_entity
            return auto_entity
        
        raise ValueError(f"Entity or table '{name}' not found")
    
    def _create_auto_entity(self, table_name: str) -> Entity:
        """–°–æ–∑–¥–∞–µ—Ç fallback entity –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –ë–î"""
        
        # –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ–º –∫–ª–∞—Å—Å
        entity_class = type(
            f"Auto_{table_name}",
            (Entity,),
            {
                "name": table_name,
                "table_name": table_name,
                "description": f"Auto-generated entity for table {table_name}"
            }
        )
        
        return entity_class(self.engine, self.metadata_obj)
    
    def list_all(self) -> list[str]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö entity (–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ + —Ç–∞–±–ª–∏—Ü—ã)"""
        registered = set(self._registry.keys())
        tables = set(self.metadata_obj.tables.keys())
        return sorted(registered | tables)
    
    def is_registered(self, name: str) -> bool:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ entity —è–≤–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π"""
        return name in self._registry
```

```python
def parse_jsql_with_entities(jsql: dict, params: dict[str, Any], registry: EntityRegistry) -> Select:
    """
    –ü–∞—Ä—Å–∏—Ç JSQL —Å —É—á–µ—Ç–æ–º –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö entity
    """
    from_name = jsql["from"]
    
    # –ü–æ–ª—É—á–∞–µ–º entity (—è–≤–Ω—É—é –∏–ª–∏ fallback)
    entity = registry.get(from_name)
    
    # –ï—Å–ª–∏ entity —è–≤–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–µ select –∫–∞–∫ CTE
    if registry.is_registered(from_name):
        entity_select = entity.select(params)
        entity_cte = entity_select.cte(name=from_name)
        base_selectable = entity_cte
    else:
        # Fallback: –æ–±—ã—á–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
        base_selectable = entity.table
    
    # –°—Ç—Ä–æ–∏–º –æ—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ø—Ä–æ—Å
    query = build_query_from_jsql(jsql, base_selectable, registry, params)
    
    return query
```

```python
# –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ UMA

def uma_select(jsql: dict, params: dict[str, Any] = None, user_context: Any = None) -> dict:
    """
    –í—ã–ø–æ–ª–Ω—è–µ—Ç JSQL –∑–∞–ø—Ä–æ—Å
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: {"metadata": {...}, "data": [...]}
    """
    pass

def uma_read(entity_name: str, id_value: Any, user_context: Any = None) -> Optional[dict]:
    """
    –ß–∏—Ç–∞–µ—Ç –æ–¥–Ω—É –∑–∞–ø–∏—Å—å entity –ø–æ id
    """
    entity = registry.get(entity_name)
    return entity.read(id_value, user_context)

def uma_save(entity_name: str, data: OrderedDict, user_context: Any = None) -> Any:
    """
    –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∑–∞–ø–∏—Å—å entity (create –∏–ª–∏ update)
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç id —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –∑–∞–ø–∏—Å–∏
    """
    entity = registry.get(entity_name)
    return entity.save(data, user_context)

def uma_delete(entity_name: str, id_value: Any, user_context: Any = None) -> bool:
    """
    –£–¥–∞–ª—è–µ—Ç –∑–∞–ø–∏—Å—å entity
    """
    entity = registry.get(entity_name)
    return entity.delete(id_value, user_context)

def uma_meta_tables(user_context: Any = None) -> list[dict]:
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö entity/—Ç–∞–±–ª–∏—Ü
    """
    pass

def uma_meta_details(entity_name: str, user_context: Any = None) -> dict:
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—è—Ö entity
    """
    pass
```

```python
from sqlalchemy import create_engine, MetaData

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
engine = create_engine("postgresql://...")
metadata = MetaData()
metadata.reflect(bind=engine)

# –°–æ–∑–¥–∞–µ–º registry
registry = EntityRegistry(engine, metadata)

# –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–µ entity (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏!)
registry.register(RestrictedUsers)
registry.register(UserProfile)

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
# 1. –û–±—ã—á–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ (fallback)
result = uma_read("orders", 123, user_context=current_user)

# 2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è entity —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π
result = uma_read("users", 456, user_context=current_user)  # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç RestrictedUsers

# 3. –ö–æ–º–ø–æ–∑–∏—Ç–Ω–∞—è entity
profile = uma_read("user_profile", 456, user_context=current_user)
profile["bio"] = "New bio"
uma_save("user_profile", profile, user_context=current_user)

# 4. JSQL –∑–∞–ø—Ä–æ—Å —Å entity
jsql = {
    "select": ["users.id", "users.name", "orders.total"],
    "from": "users",  # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç RestrictedUsers (–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞)
    "joins": [{
        "type": "left",
        "table": "orders",  # –û–±—ã—á–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ (fallback)
        "on": {"users.id": "orders.user_id"}
    }]
}
result = uma_select(jsql, params={}, user_context=current_user)
```

